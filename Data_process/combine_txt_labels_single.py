import os

'''
è¯¥è„šæœ¬ç”¨äºï¼š
    å°†ä¸€å¯¹ .txt æ–‡ä»¶ï¼ˆç‚¹äº‘æ•°æ®ï¼‰å’Œ .label æ–‡ä»¶ï¼ˆæ ‡ç­¾ï¼‰é€è¡Œæ‹¼æ¥åˆå¹¶ï¼Œè¾“å‡ºæˆ _merged.txt æ–‡ä»¶ï¼Œä¿å­˜åœ¨ç›®æ ‡ç›®å½•ä¸‹ã€‚

ä¸ä¹‹å‰çš„è„šæœ¬ä¸åŒä¹‹å¤„åœ¨äºï¼š
    æœ¬è„šæœ¬åªå¤„ç†å•ä¸ªæ–‡ä»¶å¯¹ï¼›
    åŒ…å«äº† æ–‡ä»¶åä¸€è‡´æ€§æ ¡éªŒï¼ˆä¿è¯ .txt å’Œ .label æ–‡ä»¶æ˜¯é…å¯¹çš„ï¼‰ï¼›
    é€»è¾‘æ›´æ¸…æ™°ã€å‡½æ•°æ›´ç‹¬ç«‹ã€‚


è½¬æ¢å‰çš„æ•°æ®ï¼š
    å‡è®¾.txt æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆæ¯è¡Œè¡¨ç¤ºä¸€ä¸ªç‚¹çš„åæ ‡å’Œé¢œè‰²ï¼‰ï¼š
    0.1 0.2 0.3 120 130 140
    0.4 0.5 0.6 110 120 130
    å¯¹åº” .label å†…å®¹å¦‚ä¸‹ï¼š
    1
    2
    åˆå¹¶åçš„ _merged.txtï¼š
    0.1 0.2 0.3 120 130 140 1
    0.4 0.5 0.6 110 120 130 2

é€‚ç”¨äºï¼š
    1.é¢„æµ‹åï¼šæ‹¼æ¥æ¨¡å‹è¾“å‡ºæ ‡ç­¾ä»¥ç”Ÿæˆ .plyã€.pcd ç­‰å¯è§†åŒ–æˆ–è¯„ä¼°æ ¼å¼
    2.å¯è§†åŒ–å‰å¤„ç†ï¼šä¸€è¡Œåˆå¹¶æˆå®Œæ•´å±æ€§ï¼Œä¾¿äº MeshLabã€Open3Dã€Potree å¯è§†åŒ–
    3.æ•°æ®å¯¹é½ï¼šä¿è¯é¢„æµ‹æ ‡ç­¾ä¸åŸå§‹ç‚¹äº‘æ•°æ®ä¸€ä¸€å¯¹åº”


ä¸¤æ®µä»£ç åŠŸèƒ½ä¸ä½¿ç”¨æ–¹å¼çš„åŒºåˆ«
ç‰¹å¾ / è„šæœ¬	 randla_combine_pred_txt_labels.pyï¼ˆå½“å‰ï¼‰	  randla_combine_pred_txt_labels_pi.pyï¼ˆä¹‹å‰ï¼‰
ğŸ¯ ç›®æ ‡	         åˆå¹¶ä¸€ä¸ª .txt ä¸ .label æ–‡ä»¶	             æ‰¹é‡åˆå¹¶å¤šä¸ª .txt ä¸ .labels æ–‡ä»¶
ğŸ“‚ è¾“å…¥ç›®å½•	     ç›´æ¥ä¼ å…¥å•ä¸ªæ–‡ä»¶è·¯å¾„	                      æ‰«ææ•´ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æˆå¯¹æ–‡ä»¶
ğŸ§ª æ ¡éªŒæœºåˆ¶	     æ£€æŸ¥ .txt å’Œ .label æ–‡ä»¶æ˜¯å¦åŒå	          é»˜è®¤å‡è®¾åŒå .txt ä¸ .labels æˆå¯¹å­˜åœ¨
ğŸ“ è¾“å‡ºä½ç½®	      æ‰‹åŠ¨æŒ‡å®šè¾“å‡ºè·¯å¾„	                          é»˜è®¤è¾“å‡ºåˆ°åŒä¸€ä¸ª combine æ–‡ä»¶å¤¹
ğŸ” å¯å¤ç”¨æ€§	     ç”¨äºå•æ–‡ä»¶è°ƒè¯•æˆ–æµ‹è¯•éå¸¸å¥½	                   æ›´é€‚åˆæ‰¹å¤„ç†å¤§è§„æ¨¡é¢„æµ‹ç»“æœ

ä¸¤ç§æ–‡ä»¶è½¬æ¢å‰åæ•°æ®æ ¼å¼ä¸€æ ·å—ï¼Ÿæœ€ç»ˆçš„è¾“å‡ºç»“æ„æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä¸¤ç§æ–¹å¼åªæ˜¯å¤„ç†çš„è§„æ¨¡ä¸åŒã€‚
'''


def merge_files(txt_path, labels_path, new_path):  #ç”¨äºå°†å•ä¸ª .txt æ–‡ä»¶å’Œå¯¹åº”çš„ .labels æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–°çš„ _merged.txt æ–‡ä»¶
    with open(txt_path, 'r') as txt_file, open(labels_path, 'r') as labels_file, open(new_path, 'w') as new_file:  #åŒæ—¶æ‰“å¼€ .txt å’Œ .labels æ–‡ä»¶ï¼Œä»¥åŠæ–°æ–‡ä»¶
        for txt_line, labels_line in zip(txt_file, labels_file):  #é€è¡Œè¯»å– .txt å’Œ .labels æ–‡ä»¶
            merged_line = txt_line.strip() + " " + labels_line.strip() + "\n"  #å°†ä¸¤è¡Œå†…å®¹åˆå¹¶ï¼Œä¸­é—´ç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¹¶æ·»åŠ æ¢è¡Œç¬¦
            new_file.write(merged_line)  #å†™å…¥åˆå¹¶åçš„å†…å®¹åˆ°æ–°æ–‡ä»¶ä¸­   æ¯ä¸€è¡Œæ‹¼æ¥ä¸ºï¼šåŸtxtå†…å®¹ + ç©ºæ ¼ + æ ‡ç­¾å€¼
#txt_pathï¼šç‚¹äº‘æ•°æ®è·¯å¾„ï¼ˆæ¯è¡Œä¸€èˆ¬ä¸º x y z r g bï¼‰ï¼›
#labels_pathï¼šå¯¹åº”é¢„æµ‹æ ‡ç­¾è·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼‰ï¼›
#new_pathï¼šåˆå¹¶åè¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼›
#ç”¨ zip åŒæ­¥è¯»å–ä¸¤æ–‡ä»¶å¯¹åº”è¡Œ;
#åˆå¹¶æˆï¼šx y z r g b label
#å†™å…¥åˆ° new_path æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚


# è¾“å…¥.txtæ–‡ä»¶è·¯å¾„å’Œ.labelsæ–‡ä»¶è·¯å¾„
txt_file_path = "/home/zxb/Poppy/kpconv_pred/save_folder/fenlei3_us1.5/npy_label/j27_1_fenlei_3_gauss_us1.5.txt"   #è¾“å…¥çš„ç‚¹äº‘æ•°æ®æ–‡ä»¶è·¯å¾„
labels_file_path = "/home/zxb/Poppy/kpconv_pred/save_folder/fenlei3_us1.5/npy_label/j27_1_fenlei_3_gauss_us1.5.label"  #è¾“å…¥çš„æ ‡ç­¾æ–‡ä»¶è·¯å¾„
destination_folder = "/home/zxb/Poppy/kpconv_pred/save_folder/fenlei3_us1.5/npy_label/combine"   #è¾“å‡ºç›®å½•çš„è·¯å¾„

# æå–æ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰ä½œä¸ºåˆå¹¶åæ–‡ä»¶çš„æ–‡ä»¶å
txt_base_name = os.path.splitext(os.path.basename(txt_file_path))[0]
print(txt_base_name)
labels_base_name = os.path.splitext(os.path.basename(labels_file_path))[0]
print(labels_base_name)  #æ‰“å°ä¸¤ä¸ªåŸºç¡€æ–‡ä»¶åï¼Œä¾¿äºè°ƒè¯•ç¡®è®¤æ˜¯å¦ä¸€è‡´ã€‚

# ç¡®ä¿ä¸¤ä¸ªæ–‡ä»¶å…·æœ‰ç›¸åŒçš„åŸºæœ¬æ–‡ä»¶å
if txt_base_name != labels_base_name:  #å¦‚æœä¸¤ä¸ªæ–‡ä»¶çš„åŸºæœ¬åä¸ä¸€è‡´ï¼Œåˆ™æç¤ºé”™è¯¯ã€‚è‹¥ä¸åŒ¹é…åˆ™æŠ¥é”™ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡Œåˆå¹¶ã€‚
    print("é”™è¯¯ï¼šè¾“å…¥çš„æ–‡ä»¶åä¸åŒ¹é…ï¼")
else:  #å¦‚æœåŒ¹é…ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåˆå¹¶æ“ä½œã€‚
    new_filename = txt_base_name + "_merged.txt"  #æ–°æ–‡ä»¶åä¸ºåŸæ–‡ä»¶ååŠ ä¸Š _merged åç¼€
    new_path = os.path.join(destination_folder, new_filename)  #æ„å»ºæ–°æ–‡ä»¶çš„å®Œæ•´è·¯å¾„
    merge_files(txt_file_path, labels_file_path, new_path)  #è°ƒç”¨åˆå¹¶å‡½æ•°ï¼Œå°† .txt å’Œ .labels æ–‡ä»¶åˆå¹¶åˆ°æ–°æ–‡ä»¶ä¸­

    print("åˆå¹¶å®Œæˆï¼æ–°æ–‡ä»¶å·²åˆ›å»ºï¼š", new_path)
